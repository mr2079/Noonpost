@model Tuple<List<Article>,int,int,int>
@{
    Layout = "_AdminLayout";
    int j = ((Model.Item3 - 1) * Model.Item4) + 1;
}

<style>
    .article-img {
        max-width: 150px;
        border-radius: 10px;
    }

    .author-img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        margin: 5px;
    }

    .author-name {
        font-size: 12px;
    }
</style>

<div class="table-responsive-md">
    <table class="table table-striped">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">تصویر</th>
                <th scope="col">عنوان</th>
                <th scope="col">نویسنده</th>
                <th scope="col">وضعیت</th>
                <th scope="col"></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var article in Model.Item1)
            {
                <tr>
                    <th scope="row">@j</th>
                    <td>
                        <a asp-controller="Article" asp-action="Show" asp-route-articleId="@article.Id">
                            <img class="article-img" src="~/images/articles/@article.ImageName" />
                        </a>
                    </td>
                    <td>@article.Title</td>
                    <td>
                        <div class="d-flex flex-column">
                            <a asp-controller="Author" asp-action="Index"
                           asp-route-authorId="@article.AuthorId">
                                <img class="author-img" src="~/images/users/@article.User.ImageName" />
                            </a>
                            <span class="author-name">@(article.User.FirstName + " " + article.User.LastName)</span>
                        </div>
                    </td>
                    <td>
                        @if (article.IsAccepted)
                        {
                            <span class="text-success">تایید شده</span>
                        }
                        else
                        {
                            <span class="text-danger">تایید نشده</span>
                        }
                    </td>
                    <td>
                        <a href="javascript:void(0)"
                       onclick="deleteArticle(this)"
                       class="btn btn-danger">
                            حذف مقاله
                            <span class="d-none article-id">@article.Id</span>
                    </td>
                </tr>

                j++;
            }
        </tbody>
    </table>
</div>

@if (Model.Item2 > 1)
{
    <!--pagination-->
    <div class="col-lg-12">
        <div class="pagination mt--10">
            <ul class="list-inline">
                @for (int i = 1; i < Model.Item2 + 1; i++)
                {
                    <li class="active">
                        <a asp-controller="Admin"
                   asp-action="ManageUsers"
                   asp-route-page="@i">@i</a>
                    </li>
                }
            </ul>
        </div>
        <!--/-->
    </div>
}

@section Scripts {
    <script>
        const deleteArticle = (t) => {
            var articleId = $(t).children('.article-id').html();
            Swal.fire({
                icon: 'warning',
                title: 'آیا از  حذف این مقاله مطمئن هستید؟',
                html: `<form id="deleteArticleForm" method="post" action="/Admin/DeleteArticle">` +
                    `<input type="hidden" name="userId" value="${articleId}"/>` +
                    `</form>`,
                showConfirmButton: true,
                showCloseButton: true,
                showCancelButton: true,
                confirmButtonText: 'حذف',
                confirmButtonColor: 'red',
                cancelButtonText: 'انصراف',
            })
                .then(result => {
                    if (result.isConfirmed) {
                        $("#deleteArticleForm").submit();
                    }
                });
        }
    </script>
}