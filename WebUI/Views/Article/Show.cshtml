@model Article
@{
    var commentModel = new CreateCommentViewModel();
    ViewData["ArticleId"] = Model.Id;
    int commentsPageCount = int.Parse(ViewData["CommentsPageCount"].ToString());
    int articleComments = int.Parse(ViewData["CommentsCount"].ToString());
}

<style>
    .comment-item:last-child {
        margin-bottom: 0 !important;
    }

    .widget-comments {
        margin-bottom: 0 !important;
    }

    .field-validation-error {
        color: #F67280;
        font-size: .8rem;
        padding: 10px 20px 0 20px;
    }

    .reply-comment-item {
        padding-right: 80px;
    }

    .d-none {
        display: none !important;
    }

    .pr-50 {
        padding-right: 50px !important;
    }

    .pb-50 {
        padding-bottom: 50px !important;
    }

    .pagination {
        padding: 50px 0 0 0 !important;
    }

    .unaccepted-comment {
        border: 3px solid pink;
        border-radius: 20px;
        padding: 20px;
        position: relative;
        overflow: hidden;
    }

    .unaccepted-comment-message {
        font-size: 12px;
        font-weight: 800;
        background-color: pink;
        text-align: center;
        width: 150px;
        position: absolute;
        top: 22px;
        left: -46px;
        transform: rotate(-45deg);
    }
</style>

<section class="section pt-55 ">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-8 mb-20">
                <!--Post-single-->
                <div class="post-single">
                    <div class="post-single-image">
                        <img src="~/images/articles/@Model.ImageName" alt="@Model.Title">
                    </div>
                    <div class="post-single-content">
                        <h4>@Model.Title</h4>
                        <div class="post-single-info">
                            <ul class="list-inline">
                                @if (Model.User.ImageName != null)
                                {
                                    <li>
                                        <a asp-controller="Author"
                                       asp-action="Index"
                                       asp-route-authorId="@Model.User.Id">
                                            <img src="~/images/users/@Model.User.ImageName"
                                             alt="@(Model.User.FirstName+" "+Model.User.LastName)">
                                        </a>
                                    </li>
                                }
                                <li>
                                    <a asp-controller="Author"
                                       asp-action="Index"
                                       asp-route-authorId="@Model.User.Id">
                                       @(Model.User.FirstName + " " + Model.User.LastName)
                                   </a>
                                </li>
                                <li class="dot"></li>
                                <li>@Model.CreateDate.ToShamsi()</li>
                                @if (articleComments > 0)
                                {
                                    <li class="dot"></li>
                                    <li>@articleComments دیدگاه</li>
                                }
                            </ul>
                        </div>
                    </div>

                    @if (User.Identity.IsAuthenticated && User.IsInRole("Admin"))
                    {
                        <div class="mt-4">
                            @if(!Model.IsAccepted)
                            {
                                <a asp-controller="Admin"
                                asp-action="AcceptArticle"
                                asp-route-articleId="@Model.Id"
                                    class="btn btn-success">تایید مقاله</a>
                            }
                            else
                            {
                                <a asp-controller="Admin"
                           asp-action="DeclineArticle"
                           asp-route-articleId="@Model.Id"
                           class="btn btn-warning">عدم تایید مقاله</a>
                            }
                            <a href="javascript:void(0)"
                            onclick="deleteArticle(this)"
                            class="btn btn-danger">حذف مقاله
                            <span class="d-none article-id">@Model.Id</span>
                        </a>
                        </div>
                    }

                    <div class="post-single-body">
                        @Html.Raw(Model.Text)
                    </div>

                    <div class="post-single-footer">
                        @if (Model.Tags != null)
                        {
                            <div class="tags">
                                <ul class="list-inline">
                                    @foreach (var tag in Model.Tags.Split("-"))
                                    {
                                        <li>
                                            <a asp-controller="Home"
                                       asp-action="Search"
                                       asp-route-filter="@tag">@tag</a>
                                        </li>
                                    }
                                </ul>
                            </div>
                        }
                    </div>
                </div>
                <!--/-->
                <!--widget-comments-->
                <div class="widget mb-50">

                    @if (User.Identity.IsAuthenticated)
                    {
                        ViewData["UserId"] = User.Identity.Name;
                        <partial name="_CommentPartial" model=commentModel view-data="ViewData" />
                    }
                    else
                    {
                        <div class="alert alert-info">
                            برای نوشتن دیدگاه خود ابتدا <a asp-controller="Account"
                                                       asp-action="Login"
                                                       asp-route-returnUrl="@Context.Request.Path">وارد شوید</a>
                            <br />
                            در صورتی که حساب کاربری ندارید ابتدا <a asp-controller="Account"
                                                                asp-action="Register"
                                                                asp-route-returnUrl="@Context.Request.Path">ثبت نام کنید</a>
                        </div>
                    }

                    @if (articleComments > 0 || User.IsInRole("Admin"))
                    {
                        <div class="title">
                            <h5>@articleComments دیدگاه</h5>
                        </div>

                        <ul class="widget-comments">
                            <partial name="_ShowCommentsPartial" model="Model.Comments" view-data="ViewData"/>
                        </ul>

                        @if (commentsPageCount > 1)
                        {
                            <!--pagination-->
                            <div class="col-lg-12">
                                <div class="pagination mt--10">
                                    <ul class="list-inline">
                                        @for (int i = 1; i < commentsPageCount + 1; i++)
                                        {
                                            <li class="active">
                                                <a asp-controller="Article"
                                       asp-action="Show"
                                       asp-route-articleId="@Model.Id"
                                       asp-route-commentPage="@i">@i</a>
                                            </li>
                                        }
                                    </ul>
                                </div>
                                <!--/-->
                            </div>
                        }
                    }
                    else
                    {
                        <div class="alert alert-info">
                            هیچ دیدگاهی وجود ندارد
                            <br />
                            شما اولین نفر باشید
                        </div>
                    }
                </div>
            </div>
            <div class="col-lg-4 max-width">
                <!--widget-author-->
                <div class="widget">
                    <div class="widget-author">
                        @if (Model.User.ImageName != null)
                        {
                            <a asp-controller="Author"
                           asp-action="Index"
                           asp-route-authorId="@Model.User.Id" class="image">
                                <img src="~/images/users/@Model.User.ImageName"
                                 alt="@(Model.User.FirstName+" "+Model.User.LastName)">
                            </a>
                        }
                        <h6>
                            <span>@(Model.User.FirstName + " " + Model.User.LastName)</span>
                        </h6>
                        @if (Model.User.Email != null)
                        {
                            <p>@Model.User.Email</p>
                        }
                    </div>
                </div>
                @await Component.InvokeAsync("LatestArticlesComponent")
                @await Component.InvokeAsync("TagsComponent")
                <!--/-->
            </div>
        </div>
    </div>
</section>


@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
        await Html.RenderPartialAsync("_ChangeImageScriptPartial");
        await Html.RenderPartialAsync("_ShowArticlePageScriptsPartial");
    }
}